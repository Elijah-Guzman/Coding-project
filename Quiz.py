FILTERSTOEXTENTIONS = {
  # Ability filters
  "selective attention":         "/find/descriptor/result/1.A.1.g.1",
  "selectiveAttention":          "/find/descriptor/result/1.A.1.g.1",
  "time sharing":                "/find/descriptor/result/1.A.1.g.2",
  "timeSharing":                 "/find/descriptor/result/1.A.1.g.2",
  "category flexibility":        "/find/descriptor/result/1.A.1.b.7",
  "categoryFlexibility":         "/find/descriptor/result/1.A.1.b.7",
  "deductive reasoning":         "/find/descriptor/result/1.A.1.b.4",
  "deductiveReasoning":          "/find/descriptor/result/1.A.1.b.4",
  "fluency of ideas":            "/find/descriptor/result/1.A.1.b.1",
  "fluencyOfIdeas":              "/find/descriptor/result/1.A.1.b.1",
  "inductive reasoning":         "/find/descriptor/result/1.A.1.b.5",
  "inductiveReasoning":          "/find/descriptor/result/1.A.1.b.5",
  "information ordering":        "/find/descriptor/result/1.A.1.b.6",
  "informationOrdering":         "/find/descriptor/result/1.A.1.b.6",
  "originality":                 "/find/descriptor/result/1.A.1.b.2",
  "problem sensitivity":         "/find/descriptor/result/1.A.1.b.3",
  "problemSensitivity":          "/find/descriptor/result/1.A.1.b.3",
  "memorization":                "/find/descriptor/result/1.A.1.d.1",
  "flexibility of closure":      "/find/descriptor/result/1.A.1.e.2",
  "flexibilityOfClosure":        "/find/descriptor/result/1.A.1.e.2",
  "perceptual speed":            "/find/descriptor/result/1.A.1.e.3",
  "perceptualSpeed":             "/find/descriptor/result/1.A.1.e.3",
  "speed of closure":            "/find/descriptor/result/1.A.1.e.1",
  "speedOfClosure":              "/find/descriptor/result/1.A.1.e.1",
  "mathematical reasoning":      "/find/descriptor/result/1.A.1.c.1",
  "mathematicalReasoning":       "/find/descriptor/result/1.A.1.c.1",
  "number facility":             "/find/descriptor/result/1.A.1.c.2",
  "numberFacility":              "/find/descriptor/result/1.A.1.c.2",
  "spatial orientation":         "/find/descriptor/result/1.A.1.f.1",
  "spatialOrientation":          "/find/descriptor/result/1.A.1.f.1",
  "visualization":               "/find/descriptor/result/1.A.1.f.1",
  "oral comprehension":          "/find/descriptor/result/1.A.1.a.1",
  "oralComprehension":           "/find/descriptor/result/1.A.1.a.1",
  "oral expression":             "/find/descriptor/result/1.A.1.a.3",
  "oralExpression":              "/find/descriptor/result/1.A.1.a.3",
  "written comprehension":       "/find/descriptor/result/1.A.1.a.2",
  "writtenComprehension":        "/find/descriptor/result/1.A.1.a.2",
  "written expression":          "/find/descriptor/result/1.A.1.a.4",
  "writtenExpression":           "/find/descriptor/result/1.A.1.a.4",
  "stamina":                     "/find/descriptor/result/1.A.3.b.1",
  "dynamic flexibility":         "/find/descriptor/result/1.A.3.c.2",
  "dynamicFlexibility":          "/find/descriptor/result/1.A.3.c.2",
  "extent flexibility":          "/find/descriptor/result/1.A.3.c.1",
  "extentFlexibility":           "/find/descriptor/result/1.A.3.c.1",
  "gross body coordination":     "/find/descriptor/result/1.A.3.c.3",
  "grossBodyCoordination":       "/find/descriptor/result/1.A.3.c.3",
  "gross body equilibrium":      "/find/descriptor/result/1.A.3.c.4",
  "grossBodyEquilibrium":        "/find/descriptor/result/1.A.3.c.4",
  "dynamic strength":            "/find/descriptor/result/1.A.3.a.3",
  "dynamicStrength":             "/find/descriptor/result/1.A.3.a.3",
  "explosive strenghth":         "/find/descriptor/result/1.A.3.a.2",
  "explosiveStrenghth":          "/find/descriptor/result/1.A.3.a.2",
  "static strength":             "/find/descriptor/result/1.A.3.a.1",
  "staticStrength":              "/find/descriptor/result/1.A.3.a.1",
  "trunk strength":              "/find/descriptor/result/1.A.3.a.4",
  "trunkStrength":               "/find/descriptor/result/1.A.3.a.4",
  "control precision":           "/find/descriptor/result/1.A.2.b.1",
  "controlPrecision":            "/find/descriptor/result/1.A.2.b.1",
  "multilimb coordination":      "/find/descriptor/result/1.A.2.b.2",
  "multilimbCoordination":       "/find/descriptor/result/1.A.2.b.2",
  "rate control":                "/find/descriptor/result/1.A.2.b.4",
  "rateControl":                 "/find/descriptor/result/1.A.2.b.4",
  "response orientation":        "/find/descriptor/result/1.A.2.b.3",
  "responseOrientation":         "/find/descriptor/result/1.A.2.b.3",
  "arm-hand steadiness":         "/find/descriptor/result/1.A.2.a.1",
  "armHandSteadiness":           "/find/descriptor/result/1.A.2.a.1",
  "finger dexterity":            "/find/descriptor/result/1.A.2.a.3",
  "fingerDexterity":             "/find/descriptor/result/1.A.2.a.3",
  "manual dexterity":            "/find/descriptor/result/1.A.2.a.2",
  "manualDexterity":             "/find/descriptor/result/1.A.2.a.2",
  "reaction time":               "/find/descriptor/result/1.A.2.c.1",
  "reactionTime":                "/find/descriptor/result/1.A.2.c.1",
  "speed of limb movement":      "/find/descriptor/result/1.A.2.c.3",
  "speedOfLimbMovement":         "/find/descriptor/result/1.A.2.c.3",
  "wrist-finger speed":          "/find/descriptor/result/1.A.2.c.2",
  "wristFingerSpeed":            "/find/descriptor/result/1.A.2.c.2",
  "auditory attention":          "/find/descriptor/result/1.A.4.b.2",
  "auditoryAttention":           "/find/descriptor/result/1.A.4.b.2",
  "hearing sensitivity":         "/find/descriptor/result/1.A.4.b.1",
  "hearingSensitivity":          "/find/descriptor/result/1.A.4.b.1",
  "sound localization":          "/find/descriptor/result/1.A.4.b.3",
  "soundLocalization":           "/find/descriptor/result/1.A.4.b.3",
  "speech clarity":              "/find/descriptor/result/1.A.4.b.5",
  "speechClarity":               "/find/descriptor/result/1.A.4.b.5",
  "speech recognition":          "/find/descriptor/result/1.A.4.b.4",
  "speechRecognition":           "/find/descriptor/result/1.A.4.b.4",
  "depth perception":            "/find/descriptor/result/1.A.4.a.6",
  "depthPerception":             "/find/descriptor/result/1.A.4.a.6",
  "far vision":                  "/find/descriptor/result/1.A.4.a.2",
  "farVision":                   "/find/descriptor/result/1.A.4.a.2",
  "glare sensitivity":           "/find/descriptor/result/1.A.4.a.7",
  "glareSensitivity":            "/find/descriptor/result/1.A.4.a.7",
  "near vision":                 "/find/descriptor/result/1.A.4.a.1",
  "nearVision":                  "/find/descriptor/result/1.A.4.a.1",
  "night vision":                "/find/descriptor/result/1.A.4.a.4",
  "nightVision":                 "/find/descriptor/result/1.A.4.a.4",
  "peripheral vision":           "/find/descriptor/result/1.A.4.a.5",
  "peripheralVision":            "/find/descriptor/result/1.A.4.a.5",
  "visual color discrimination": "/find/descriptor/result/1.A.4.a.3",
  "visualColorDiscrimination":   "/find/descriptor/result/1.A.4.a.3",

  # Interests
  "realistic":     "/explore/interests/Realistic",
  "investigative": "/explore/interests/Investigative",
  "artistic":      "/explore/interests/Artistic",
  "social":        "/explore/interests/Social",
  "enterprising":  "/explore/interests/Enterprising",
  "conventional":  "/explore/interests/Conventional"
}

CATEGORYTOABILITIES = {
  "focus": [
    "selectiveAttention", 
    "timeSharing",
    "oralComprehension",
    "writtenComprehension",
    "auditoryAttention"
    ],
  "perceptiveness": [
    "problemSensitivity",
    "flexibilityOfClosure",
    "hearingSensitivity",
    "soundLocalization",
    "speechRecognition",
    "depthPerception",
    "peripheralVision",
    "visualColorDiscrimination"
  ],
  "reasoning": [
    "deductiveReasoning",
    "inductiveReasoning",
    "mathematicalReasoning"
  ],
  "creativity": [
    "categoryFlexibility",
    "fluencyOfIdeas",
    "originality",
    "visualization"
  ],
  "precision": [
    "speedOfClosure",
    "numberFacility",
    "oralExpression",
    "writtenExpression",
    "speechClarity",
    "rateControl",
    "reactionTime"
  ],
  "physicalCoordination": [
    "dynamicFlexibility",
    "extentFlexibility",
    "grossBodyCoordination"
  ],
  "physicalStrength": [
    "stamina",
    "dynamicStrength",
    "staticStrength"
  ]
}

''' Abilities:

Focus:
  Selective Attention
  Time Sharing
  Oral Comprehension
  Written Comprehension
  Auditory Attention

Perceptiveness:
  Problem Sensitivity
  Flexibility of Closure
  Hearing Sensitivity
  Sound Localization
  Speech Recognition
  Depth Perception
  Peripheral Vision
  Visual Color Discrimination

Reasoning:
  Deductive Reasoning
  Inductive Reasoning
  Mathematical Reasoning
  
Creativity/Idea Generation:
  Category Flexibility
  Fluency of Ideas
  Originality
  Visualization

Precision:
  Speed of Closure
  Number Facility
  Oral Expression
  Written Expression
  Speech Clarity
  Rate Control
  Reaction Time

Physical Coordination:
  Dynamic Flexibility
  Extent Flexibility
  Gross Body Coordination

Physical Strength:
  Stamina
  Dynamic Strength
  Static Strength


'''

''' Job Zone Info
Job Zone 1: None of the Above (may require hs diploma equivalent)
Job Zone 2: High School Diploma
Job Zone 3: Associate's Degree
Job Zone 4: Bachelor's Degree
Job Zone 5: Master's Degree / Other Graduate School Degree
'''

from bs4 import BeautifulSoup
import requests

def scrape_with_results(quizResults):
    addressStarter = "https://onetonline.org"
    jobsFound = []
    sitesToScrape = []
    argsDict = {}
    jobZone = 1

    ## Comes in as an ImmutableMultiDict, converts to regular dict
    for key in quizResults.keys():
      argsDict.update({key: []})
      for value in quizResults.getlist(key):
        argsDict[key].append(value)

    # Education Level
    match argsDict["education"][0]:
      case "N/A":
        jobZone = 1
      case "HS":
        jobZone = 2
      case "AD":
        jobZone = 3
      case "BD":
        jobZone = 4
      case "AdvD":
        jobZone = 5

    # Interests
    if argsDict.get("interests") is not None:
      for interest in argsDict["interests"]:
        sitesToScrape.append(addressStarter + FILTERSTOEXTENTIONS[interest])
    
    # Abilities
    if argsDict.get("interests") is not None:
      for category in argsDict["abilities"]:
        for ability in CATEGORYTOABILITIES[category]:
          sitesToScrape.append(addressStarter + FILTERSTOEXTENTIONS[ability])

    # Scraping
    for siteURL in sitesToScrape:
      jobNames = []
      webpage = requests.get(siteURL)
      divSoup = BeautifulSoup(webpage.text, "html.parser")
      
      ## Get top 3 results in job zone (education level). If not enough and able, go down a level.
      jobsFoundThisItr = 0
      zoneItrs = 0
      while jobsFoundThisItr < 3:
        if jobZone - zoneItrs <= 0:
          break
        jobZoneElements = divSoup.find_all("tr", attrs={"class": f"zone-all zone-{jobZone - zoneItrs}"}, limit=3)
        for element in jobZoneElements:
          jobNames.append(element.find("td", attrs={"class": "w-45 mw-10e sorter-text"}))
          jobsFoundThisItr += 1
        zoneItrs += 1

      for job in jobNames:
        x = job.get_text().strip()
        jobsFound.append(x)

    # Formatting and Returning
    ## Counting how many times each job is mentioned
    jobTitleCounts = {}
    for jobTitle in jobsFound:
      if jobTitleCounts.get(jobTitle) is not None:
        jobTitleCounts[jobTitle] += 1
      else:
        jobTitleCounts.update({jobTitle: 1})

    ## Ordering jobs based on times mentioned
    jobTitleCounts = dict(sorted(jobTitleCounts.items(), key=lambda item: item[1]))

    return list(jobTitleCounts.keys())[-5:]